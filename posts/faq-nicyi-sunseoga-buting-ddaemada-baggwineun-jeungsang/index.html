<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>[FAQ] NIC의 순서가 부팅 때마다 바뀌는 증상 &middot; Lunatine</title>
        <meta name="description" content="이미 여러 인터넷 커뮤니티에서 알려진대로 RHEL 기준으로 RHEL5 부터 서버를 리부팅 할 때 마다 네트워크 카드의 순서가 뒤 바뀌는 증상이 발생하곤 한다.
예를 들어 PCI 장치번호로 00:08.0이 eth0 였고 00:09.0가 eth1이었는데 리부팅을 하고 보니 eth0가 eth1으로 잡히고 eth1이 eth2로 잡히는 증상 또는 서로 바뀌는 증상들이 발생하는 것이다.
이것에 대한 해결 방법은 여러가지가 존재하는데 하나씩 살펴보면
NIC의 MAC 주소를 이용하는 방법 가장 정확하고 간편한 방법 중의 하나로 네트워크 장치 설정에 대해서 MAC 주소를 지정하는 방법이다.">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.55.6" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta property="og:title" content="[FAQ] NIC의 순서가 부팅 때마다 바뀌는 증상">
<meta property="og:description" content="이미 여러 인터넷 커뮤니티에서 알려진대로 RHEL 기준으로 RHEL5 부터 서버를 리부팅 할 때 마다 네트워크 카드의 순서가 뒤 바뀌는 증상이 발생하곤 한다.
예를 들어 PCI 장치번호로 00:08.0이 eth0 였고 00:09.0가 eth1이었는데 리부팅을 하고 보니 eth0가 eth1으로 잡히고 eth1이 eth2로 잡히는 증상 또는 서로 바뀌는 증상들이 발생하는 것이다.
이것에 대한 해결 방법은 여러가지가 존재하는데 하나씩 살펴보면
NIC의 MAC 주소를 이용하는 방법 가장 정확하고 간편한 방법 중의 하나로 네트워크 장치 설정에 대해서 MAC 주소를 지정하는 방법이다.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://lunatine.github.io/posts/faq-nicyi-sunseoga-buting-ddaemada-baggwineun-jeungsang/">
        <link rel="stylesheet" href="https://lunatine.github.io/dist/styles.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        
        
        
    </head>
    <body>
        

        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <h1 class="site-title">
                                <a title="Lunatine&#39;s Box" href="https://lunatine.github.io/">Lunatine&#39;s Box</a>
                            </h1>
                        
                        <a class="button-square" href="https://lunatine.github.io/index.xml"><i class="fa fa-rss"></i></a>
                        
                        
                        
                        
                        
                        
                        
                        
                    </div>

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a title="Blog" href="/posts">Blog</a>
    </li>

    <li class="site-nav-item">
        <a title="About" href="/about/">About</a>
    </li>

                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container">
        <header class="post-header">
    <h1 class="post-title">[FAQ] NIC의 순서가 부팅 때마다 바뀌는 증상</h1>
    
</header>

        <div class="post-content clearfix">
    

    

<p>이미 여러 인터넷 커뮤니티에서 알려진대로 RHEL 기준으로 RHEL5 부터 서버를 리부팅 할 때 마다 네트워크 카드의 순서가 뒤 바뀌는 증상이 발생하곤 한다.</p>

<p>예를 들어 PCI 장치번호로 00:08.0이 eth0 였고 00:09.0가 eth1이었는데 리부팅을 하고 보니 eth0가 eth1으로 잡히고 eth1이 eth2로 잡히는 증상 또는 서로 바뀌는 증상들이 발생하는 것이다.</p>

<p>이것에 대한 해결 방법은 여러가지가 존재하는데 하나씩 살펴보면</p>

<h2 id="nic의-mac-주소를-이용하는-방법">NIC의 MAC 주소를 이용하는 방법</h2>

<p>가장 정확하고 간편한 방법 중의 하나로 네트워크 장치 설정에 대해서 MAC 주소를 지정하는 방법이다. Redhat 계열로 예를 들면</p>

<pre><code>/etc/sysconfig/network-scripts/ifcfg-eth0
</code></pre>

<p>위 파일에 HWADDR 항목을 추가해서 실제 NIC 장치의 MAC주소를 지정하면 몇 번을 리부팅해도 바뀌지 않는다.</p>

<pre><code>DEVICE=eth0
BOOTPROTO=static
BROADCAST=123.123.123.255
IPADDR=123.123.123.123
NETMASK=255.255.255.224
NETWORK=123.123.123.0
HWADDR=00:A0:D1:12:E7:11
</code></pre>

<p>다만, 이와 같은 방법의 경우 서버시스템의 장애로 인해 서버를 교체하게 되면 (즉, 디스크는 유지하고 서버만 교체) HWADDR이 달라지게 되므로 다시 수정해 주어야 하는 번거로움이 생길 수 있다.</p>

<p>참고가 되는 문서 : <a href="https://access.redhat.com/kb/docs/DOC-15331">레드햇 KBASE</a></p>

<h2 id="udev-룰셋을-통한-해결방법">udev 룰셋을 통한 해결방법</h2>

<p>최근 리눅스에서는 udev를 통해서 장치를 관리할 수 있고 원하는대로 룰셋을 지정할 수 있다. 이러한 udev의 룰셋을 이용하는 방법으로 아래와 같은 udev 룰을 추가한다.</p>

<p>파일위치 : /etc/udev/rules.d/10-local.rules (없는 파일이므로 새로생성)</p>

<pre><code>SUBSYSTEM==&quot;pci&quot;, SYSFS{class}==&quot;0x020000&quot;, OPTIONS=&quot;ignore_device&quot;
</code></pre>

<p>해당 파일에 기록한 udev의 의미는 sysfs의 해당 클래스에 대해서 룰셋 지정을 무시하라는 것이다. 기본적으로 60-net.rules 파일에 기록된 내용에 의해서 추가되기전에 이와 같은 룰셋을 지정하여 순서대로 (일반적으로 PCI 버스 순서) 인식하도록 하는 방법이다.</p>

<p>룰셋 파일 하나만 추가해주면 되고 생각보다 잘 적용되는 방법이다. 이와 유사하게 커널 부트 파라미터로 지정해서 장치인식을 Legacy 방식으로 하는 방법도 있지만 udev를 쓰는 환경이라면 이러한 방법을 더 추천한다.</p>

<p>참고할만한 링크 : <a href="https://bugzilla.redhat.com/show_bug.cgi?id=192084#c6">Redhat bugzilla</a></p>

<h2 id="etc-iftab-설정파일로-지정하기">/etc/iftab 설정파일로 지정하기</h2>

<p>다른 배포판은 확인을 못해봤지만 wireless-tools 패키지에 들어있는 ifrename 유틸리티를 이용하는 방법이다. /etc/iftab이란 설정파일을 아래와 같은 방식으로 작성하고</p>

<pre><code>eth0 businfo 0000:00:08.0
eth1 businfo 0000:00:09.0
</code></pre>

<p>위의 내용에서 0000:00:08.0은 lspci 등의 명령으로 확인할 수 있는 PCI 장치 번호이다. iftab을 작성했으면 아래의 rc 스크립트를 등록한다.</p>

<p>파일명 : /etc/init.d/ifrename</p>

<pre><code>#!/bin/sh

NAME=ifrename
IFRENAME=/sbin/ifrename
IFTAB=/etc/iftab

test -f $IFRENAME || exit 0
test -f $IFTAB || exit 0

case &quot;$1&quot; in
        start|reload|force-reload|restart)
        $IFRENAME
        ;;
        test)
        $IFRENAME -DV
        ;;
        stop)
        ;;
        *)
        echo &quot;Usage: $NAME {start|stop|reload|force-reload|restart}&quot;
        ;;
esac

exit 0
</code></pre>

<p>그리고, 부팅하는 런레벨에 맞추어 S09ifrename 정도로 심볼릭을 걸어준다.</p>

<pre><code>ln -s /etc/init.d/ifrename /etc/rc3.d/S09ifrename
</code></pre>

<p>이 방법은 서버가 바뀌어도 H/W 스펙이 같다면 PCI 값이 바뀌는 경우가 없기 때문에 유용한 방법이지만 대체로 udev 룰셋보다 번거롭기 때문에 잘 쓰이지는 않는다. 하지만, 별도의 멀티포트 NIC카드를 구매해서 장착한 경우라면 앞서 설명한 udev 룰셋으로 해결이 안될 수 있기 때문에 (즉, 내가 장착한 카드를 eth0로 잡고 싶지만 버스순서 때문에 온보드 NIC이 먼저 잡히는 경우 등) 이러한 방법을 사용하면 된다.</p>

<p><a href="http://www.fxp0.org.ua/2007/apr/20/swapping-interface-names-debian-etch-ifrename/">참고할 만한 링크</a></p>

</div>

        <footer class="post-footer clearfix">
    
        <p class="post-tags">
            <span>Tagged:</span>
            
            
                <a href="/tags/nic-order/">nic order</a>, 
            
                <a href="/tags/udev/">udev</a>
            
        </p>
    

    <div class="share">
        
            <a class="icon-twitter" href="https://twitter.com/share?text=%5bFAQ%5d%20NIC%ec%9d%98%20%ec%88%9c%ec%84%9c%ea%b0%80%20%eb%b6%80%ed%8c%85%20%eb%95%8c%eb%a7%88%eb%8b%a4%20%eb%b0%94%eb%80%8c%eb%8a%94%20%ec%a6%9d%ec%83%81&url=https%3a%2f%2flunatine.github.io%2fposts%2ffaq-nicyi-sunseoga-buting-ddaemada-baggwineun-jeungsang%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fa fa-twitter"></i>
                <span class="hidden">Twitter</span>
            </a>
        

        
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2flunatine.github.io%2fposts%2ffaq-nicyi-sunseoga-buting-ddaemada-baggwineun-jeungsang%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <i class="fa fa-facebook"></i>
                <span class="hidden">Facebook</span>
            </a>
        

        
        
    </div>
</footer>
    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a title="Lunatine&#39;s Box" href="https://lunatine.github.io/">Lunatine&#39;s Box</a>
                    </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#">
                        <i class="fa fa-angle-up"></i>
                    </a>
                </div>

                <p class="footer-copyright">
                    <span>&copy; 2019 / Powered by <a href="https://gohugo.io/">Hugo</a></span>
                </p>
                <p class="footer-copyright">
                    <span><a href="https://github.com/roryg/ghostwriter">Ghostwriter theme</a> By <a href="http://jollygoodthemes.com">JollyGoodThemes</a></span>
                    <span>/ <a href="https://github.com/jbub/ghostwriter">Ported</a> to Hugo By <a href="https://github.com/jbub">jbub</a></span>
                </p>
            </div>
        </footer>

        <script src="https://lunatine.github.io/js/jquery-1.11.3.min.js"></script>
        <script src="https://lunatine.github.io/js/jquery.fitvids.js"></script>
        
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        
        
        <script src="https://lunatine.github.io/js/scripts.js"></script>
    </body>
</html>

